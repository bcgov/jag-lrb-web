{
   "kind": "Template",
   "apiVersion": "v1",
   "metadata": {
      "name": "openshift-helloworld-sample",
      "creationTimestamp": null,
      "annotations": {
         "description": "This example shows how to create a simple openshift application in openshift origin v3",
         "iconClass": "icon-openshift",
         "tags": "instant-app,openshift,mysql"
      }
   },
   "objects": [
      {
         "kind": "Secret",
         "apiVersion": "v1",
         "metadata": {"name": "dbsecret"},
         "stringData" : {
            "mysql-user" : "${MYSQL_USER}",
            "mysql-password" : "${MYSQL_PASSWORD}"
         }
      },
      {
         "kind": "Service",
         "apiVersion": "v1",
         "metadata": {
            "name": "frontend",
            "creationTimestamp": null
         },
         "spec": {
            "ports": [
               {
                  "name": "web",
                  "protocol": "TCP",
                  "port": 5432,
                  "targetPort": 8080,
                  "nodePort": 0
               }
            ],
            "selector": {"name": "frontend"},
            "type": "ClusterIP",
            "sessionAffinity": "None"
         },
         "status": {
            "loadBalancer": {}
         }
      },
      {
         "kind": "Route",
         "apiVersion": "v1",
         "metadata": {
            "name": "route-edge",
            "creationTimestamp": null,
            "annotations": {
               "template.openshift.io/expose-uri": "http://{.spec.host}{.spec.path}"
            }
         },
         "spec": {
            "host": "www.example.com",
            "to": {
               "kind": "Service",
               "name": "frontend"
            },
            "tls": {
               "termination": "edge"
            }
         },
         "status": {}
      },
      { 
         "kind": "ImageStream",
         "apiVersion": "v1",
         "metadata": {
            "name": "origin-openshift-sample",
            "creationTimestamp": null
         },
         "spec": {},
         "status": {
            "dockerImageRepository": ""
         }
      },
      { 
         "kind": "ImageStream",
         "apiVersion": "v1",
         "metadata": {
            "name": "openshift-22-ubuntu7",
            "creationTimestamp": null 
         },
         "spec": {
            "dockerImageRepository": "ubuntu/openshift-22-ubuntu7"
         },
         "status": {
            "dockerImageRepository": ""
         }
      },  
      {
         "kind": "BuildConfig",
         "apiVersion": "v1",
         "metadata": {
            "name": "openshift-sample-build",
            "creationTimestamp": null,
            "labels": {"name": "openshift-sample-build"}
         },
         "spec": {
            "triggers": [
               { "type": "GitHub",
                  "github": {
                  "secret": "secret101" } 
               },
               {
                  "type": "Generic",
                  "generic": {
                     "secret": "secret101",
                     "allowEnv": true } 
               },
               { 
                  "type": "ImageChange",
                  "imageChange": {} 
               },
               { "type": "ConfigChange"}
            ],
            "source": {
               "type": "Git",
               "git": {
                  "uri": "https://github.com/openshift/openshift-hello-world.git" } 
            },
            "strategy": {
               "type": "Docker",
               "dockerStrategy": {
                  "from": {
                     "kind": "ImageStreamTag",
                     "name": "openshift-22-ubuntu7:latest" 
                  },
                  "env": [
                     {
                        "name": "EXAMPLE",
                        "value": "sample-app"
                     }
                  ]              
               }
            },
            "output": {
               "to": {
                  "kind": "ImageStreamTag",
                  "name": "origin-openshift-sample:latest"
               }
            },
            "postCommit": {
               "args": ["bundle", "exec", "rake", "test"]
            },
            "status": {
               "lastVersion": 0
            }
         }
      },
      {
         "kind": "DeploymentConfig",
         "apiVersion": "v1",
         "metadata": {
            "name": "frontend",
            "creationTimestamp": null
         },
         "status": {
            "lastVersion": 0
         }
   "spec": {
      "strategy": {
         "type": "Rolling",
         "rollingParams": {
            "updatePeriodSeconds": 1,
            "intervalSeconds": 1,
            "timeoutSeconds": 120,
            "pre": {
               "failurePolicy": "Abort",
               "execNewPod": {
                  "command": [
                     "/bin/true"
                  ],
                  "env": [
                     { 
                        "name": "CUSTOM_VAR1",
                        "value": "custom_value1"
                     }
                  ]                 
               }
            }
         }
      }
   },
   "triggers": [
      {
         "type": "ImageChange",
         "imageChangeParams": {
            "automatic": true,
            "containerNames": [
               "openshift-helloworld"
            ],
            "from": {
               "kind": "ImageStreamTag",
               "name": "origin-openshift-sample:latest"
            }
         }
      },
      {
         "type": "ConfigChange"
      }
   ],
   "replicas": 2,
   "selector": {
      "name": "frontend"
   },
   "template": {
      "metadata": {
         "creationTimestamp": null,
         "labels": {
            "name": "frontend"
         }
      },
      "spec": {
         "containers": [
            {
               "name": "openshift-helloworld",
               "image": "origin-openshift-sample",
               "ports": [
                  { 
                     "containerPort": 8080,
                     "protocol": "TCP" 
                  }
               ],
               "env": [
                  {
                     "name": "MYSQL_USER",
                     "valueFrom": {
                        "secretKeyRef" : {
                           "name" : "dbsecret",
                           "key" : "mysql-user"
                        }
                     }
                  },
                  {
                     "name": "MYSQL_PASSWORD",
                     "valueFrom": {
                        "secretKeyRef" : {
                           "name" : "dbsecret",
                           "key" : "mysql-password"
                        }
                     }
                  },
                  {
                     "name": "MYSQL_DATABASE",
                     "value": "${MYSQL_DATABASE}"
                  }
               ],
               "resources": {},
               "terminationMessagePath": "/dev/termination-log",
               "imagePullPolicy": "IfNotPresent",
               "securityContext": {
                  "capabilities": {},
                  "privileged": false
               }
            }
         ],
         "restartPolicy": "Always",
         "dnsPolicy": "ClusterFirst"
      },
      "status": {}
   }
}